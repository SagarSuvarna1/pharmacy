<!DOCTYPE html>
<html lang="en">
<head>
  <title>Opening Stock Batches - Pharmacy</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Inter:wght@500;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(120deg, #f3fafd 0%, #e3ecfa 100%);
      font-family: 'Inter', Arial, sans-serif;
    }
    .container {
      max-width: 960px;
      margin: 40px auto;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 14px 39px #2179e710, 0 1.5px 7px #eaf6fe;
      padding: 36px 36px 24px 36px;
      min-height: 75vh;
    }
    h2 {
      color: #2367c8;
      font-weight: 700;
      font-size: 2rem;
      margin-top: 0;
      margin-bottom: 18px;
      letter-spacing: 0.01em;
      display: flex; align-items: center; gap:11px;
    }
    .add-btn {
      margin-left: auto;
      background: linear-gradient(90deg, #229020 25%, #19b876 98%);
      color: #fff;
      border-radius: 6px;
      padding: 10px 24px;
      font-weight: 600;
      font-size: 1rem;
      text-decoration: none;
      box-shadow: 0 2px 8px #19b87612;
      display: flex; align-items: center; gap:7px;
      transition: background 0.16s, box-shadow 0.18s;
    }
    .add-btn svg { vertical-align:middle;}
    .add-btn:hover { background: #16824f; box-shadow:0 4px 15px #19b87624;}
    .top-links {
      margin-bottom: 17px;
      display: flex; gap: 9px 18px; flex-wrap: wrap;
      align-items: center;
    }
    .top-links a {
      color: #2367c8;
      background: #f3fafd;
      padding:7px 15px; font-weight:500; border-radius: 6px;
      text-decoration: none; font-size: 1.01rem;
      display:flex; align-items:center; gap:4px;
      transition: background 0.15s, color 0.12s;
      box-shadow: 0 1.3px 7px #3089a214;
    }
    .top-links a:hover { background: #e3f0fa; color:#174e9a; }
    .table-scroll { overflow-x:auto; }
    table {
      border-collapse: separate;
      border-spacing: 0;
      width: 100%;
      font-size: 1rem;
      background: #fafdff;
      border-radius: 13px;
      margin-top: 8px;
      box-shadow:0 1.2px 6px #e3ecfa56;
      overflow: hidden;
    }
    th, td {
      padding: 13px 9px;
      border-bottom: 1px solid #e2ecf5;
      font-size: 1rem;
      text-align: center;
    }
    th {
      background: linear-gradient(90deg, #e6f6f3, #e4eefc 85%);
      color: #247bb8;
      font-weight: 700;
      letter-spacing: 0.015em;
      position: sticky; top: 0; z-index:2;
      border-top: none;
    }
    tbody tr { transition: background 0.13s; }
    tbody tr:hover { background: #e7f2fb; }
    tr:nth-child(even) { background: #f6fbfe; }
    .expired {
      background: #fdeae8 !important;
      color: #e13b3c;
      font-weight:600;
      position:relative;
    }
    .expired td { background: inherit !important; }
    .expired::after {
      content: "Expired";
      font-size: 0.81em;
      color:#fff; background: #e13b3c;
      border-radius:9px;
      padding:2px 11px;
      position: absolute; left:9px; top:11px;
      font-weight:600;
    }
    .low-stock {
      background: #fffbe7 !important;
      color: #c38f11;
      font-weight:bold;
      position:relative;
    }
    .low-stock::after {
      content: "Low";
      font-size: 0.81em;
      background: #ffe189;
      color:#b48b16;
      border-radius:7px;
      padding:2.5px 11px;
      position: absolute; left:9px; top:10px;
      font-weight:600;
    }
    td > .exp-ok { color: #14b533; }
    .expired span[title], .low-stock span[title] {
      font-size:1.2em; vertical-align:middle; margin-left:3px;
    }
    @media (max-width: 900px) {
      .container { padding: 2vw 2vw; }
      h2 { font-size: 1.22rem;}
      table, th, td { font-size: 0.97rem; }
      .add-btn { font-size:0.97rem; padding:7px 13px; }
      .top-links { gap:6px 4px;}
    }
    @media (max-width: 610px) {
      th, td { padding: 7px 2px; }
      .container { padding:2vw 1vw;}
    }
  </style>
</head>
<body>
  <div class="container">
    <div style="display:flex; align-items:center; gap:16px;">
      <h2>
        <svg width="28" height="28" viewBox="0 0 40 40" fill="none">
          <circle cx="20" cy="20" r="20" fill="#e2f7ee"/>
          <rect x="11" y="16" width="18" height="8" rx="4" fill="#27b8a0"/>
          <rect x="17.1" y="10.7" width="6" height="18.6" rx="3" transform="rotate(45 20 20)" fill="#71cbfa"/>
        </svg>
        Opening Stock Batches
      </h2>
      <a href="/stock/add" class="add-btn">
        <svg width="17" height="17" fill="none" stroke="#fff" stroke-width="2" style="margin-right:2px"><circle cx="8.5" cy="8.5" r="8" stroke="#fff" fill="none"/><path d="M8.5 5v7M5 8.5h7" stroke="#fff" stroke-linecap="round"/></svg>
        Add Batch
      </a>
    </div>
    <div class="top-links">
      <a href="/dashboard"><svg width="15" height="15" fill="none" stroke="#2367c8" stroke-width="2"><path d="M3 8.5L8.5 3 14 8.5V15H10V11H7v4H3V8.5Z"/></svg>Dashboard</a>
      <a href="/drugs"><svg width="15" height="15" fill="none" stroke="#2367c8" stroke-width="2"><rect x="2" y="6" width="11" height="7" rx="1.5"/><rect x="4" y="2" width="7" height="4" rx="1.2"/></svg>Drug Master</a>
      <a href="/inventory"><svg width="15" height="15" fill="none" stroke="#2367c8" stroke-width="2"><rect x="2" y="2" width="11" height="11" rx="2"/><path d="M2 6.5h11"/></svg>Inventory</a>
      <a href="/billing"><svg width="15" height="15" fill="none" stroke="#2367c8" stroke-width="2"><rect x="3" y="5" width="9.5" height="8" rx="2"/><path d="M6 3v3M11 3v3"/></svg>Billing</a>
    </div>
    <div class="table-scroll">
      <table>
        <thead>
          <tr>
            <th>Drug</th>
            <th>Batch No</th>
            <th>Expiry</th>
            <th>MRP</th>
            <th>Sale Price</th>
            <th>Purchase Date</th>
            <th>Opening Stock</th>
            <th>Current Stock</th>
          </tr>
        </thead>
        <tbody>
          <% if (stocks && stocks.length) { 
               const today = new Date();
               stocks.forEach(function(batch) { 
                 let exp = batch.expiry ? new Date(batch.expiry) : null;
                 let isExpired = exp && exp < today;
                 let lowStock = (batch.current_stock || 0) <= 5;
          %>
            <tr class="<%= isExpired ? 'expired' : (lowStock ? 'low-stock' : '') %>">
              <td><%= batch.drug_name %></td>
              <td><%= batch.batch_number %></td>
              <td>
                <%= batch.expiry ? batch.expiry.slice(0,7) : '' %>
                <% if (isExpired) { %> <span title="Expired!">⚠️</span> <% } %>
                <% if (!isExpired && batch.expiry) { %>
                  <span class="exp-ok" title="Ok">&#10003;</span>
                <% } %>
              </td>
              <td><%= batch.mrp %></td>
              <td><%= batch.sale_price %></td>
              <td><%= batch.purchase_date ? batch.purchase_date.slice(0,10) : '' %></td>
              <td><%= batch.opening_stock %></td>
              <td><%= batch.current_stock %></td>
            </tr>
          <% }) 
           } else { %>
            <tr>
              <td colspan="8" style="text-align:center; color:#b7bfc7; background:#f7fcfa; font-size:1.1em;">
                No opening stock batches found.
              </td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>
</body>
</html>
